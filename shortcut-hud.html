<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shortcut HUD - „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÂ≠¶Áøí„ÉÑ„Éº„É´</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes slide-in-from-left { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes slide-in-from-bottom { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes zoom-in-95 { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .animate-in { animation-duration: 0.5s; animation-fill-mode: both; }
    .slide-in-from-left { animation-name: slide-in-from-left; }
    .slide-in-from-bottom { animation-name: slide-in-from-bottom; }
    .zoom-in-95 { animation-name: zoom-in-95; }
    .duration-500 { animation-duration: 500ms; }
    .duration-200 { animation-duration: 200ms; }
    .delay-100 { animation-delay: 100ms; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // Simple SVG Icon Components
    const Icons = {
      Monitor: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="20" height="14" x="2" y="3" rx="2"/><path d="M8 21h8M12 17v4"/></svg>,
      Edit: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
      Settings: ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
      Clock: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>,
      FileText: ({className = "w-3 h-3"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>,
      CheckSquare: ({className = "w-3 h-3"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
      Plus: ({className = "w-3 h-3"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5v14"/></svg>,
      Trash2: ({className = "w-3 h-3"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
      Play: ({className = "w-5 h-5"}) => <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M5 3l14 9-14 9V3z"/></svg>,
      Pause: ({className = "w-5 h-5"}) => <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6zM14 4h4v16h-4z"/></svg>,
      RotateCcw: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
      Calendar: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>,
      Search: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>,
      CheckCircle: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>,
      Download: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>,
      Upload: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>,
      X: ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>,
      Keyboard: ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M7 16h10"/></svg>,
      Save: ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><path d="M17 21v-8H7v8M7 3v5h8"/></svg>,
    };

    function ShortcutHUD() {
      const canvasRef = useRef(null);
      const containerRef = useRef(null);

      const [activeApp, setActiveApp] = useState('excel.exe');
      const [scrollOffset, setScrollOffset] = useState(0);
      useEffect(() => { setScrollOffset(0); }, [activeApp]);

      const [animProgress, setAnimProgress] = useState(0);
      const requestRef = useRef({});

      const [isEditing, setIsEditing] = useState(false);
      const [isSettingsOpen, setIsSettingsOpen] = useState(false);
      const [editingData, setEditingData] = useState(null);

      const [searchQuery, setSearchQuery] = useState('');
      const [showUnmasteredOnly, setShowUnmasteredOnly] = useState(false);

      const [time, setTime] = useState(new Date());
      useEffect(() => {
        const timer = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      const getCalendarDays = () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        const days = [];
        for (let i = 0; i < firstDay; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(i);
        return days;
      };
      const currentDay = new Date().getDate();

      const initialData = {
        'desktop': {
          displayName: 'Desktop',
          color: '#00a8e8',
          groups: [
            {
              category: '„Ç∑„Çπ„ÉÜ„É†ÂÖ®Ëà¨',
              items: [
                { key: 'Win + D', desc: '„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„ÇíË°®Á§∫/ÈùûË°®Á§∫', mastered: false },
                { key: 'Win + E', desc: '„Ç®„ÇØ„Çπ„Éó„É≠„Éº„É©„Éº„ÇíÈñã„Åè', mastered: true },
                { key: 'Win + L', desc: 'PC„Çí„É≠„ÉÉ„ÇØ (Èõ¢Â∏≠ÊôÇ)', mastered: true },
                { key: 'Win + V', desc: '„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥ (ÂøÖÈ†à)', mastered: false },
                { key: 'Win + .', desc: 'ÁµµÊñáÂ≠ó„ÉªË®òÂè∑„Éë„Éç„É´', mastered: false },
                { key: 'Win + Shift + S', desc: 'ÁîªÈù¢Âàá„ÇäÂèñ„Çä („Çπ„ÇØ„Ç∑„Éß)', mastered: true },
                { key: 'Ctrl + Shift + Esc', desc: '„Çø„Çπ„ÇØ„Éû„Éç„Éº„Ç∏„É£„Éº', mastered: false },
              ]
            },
            {
              category: '„Ç¶„Ç£„É≥„Éâ„Ç¶Êìç‰Ωú',
              items: [
                { key: 'Win + ‚Üê / ‚Üí', desc: '„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÂ∑¶Âè≥„Å´ÂàÜÂâ≤', mastered: false },
                { key: 'Win + ‚Üë / ‚Üì', desc: 'ÊúÄÂ§ßÂåñ / ÊúÄÂ∞èÂåñ', mastered: false },
                { key: 'Alt + Tab', desc: '„Ç¢„Éó„É™Âàá„ÇäÊõø„Åà', mastered: true },
                { key: 'Win + Tab', desc: '„Çø„Çπ„ÇØ„Éì„É•„Éº (‰∏ÄË¶ß)', mastered: false },
              ]
            },
            {
              category: '‰ªÆÊÉ≥„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó',
              items: [
                { key: 'Win + Ctrl + D', desc: 'Êñ∞„Åó„ÅÑ„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó‰ΩúÊàê', mastered: false },
                { key: 'Win + Ctrl + ‚Üê/‚Üí', desc: '„Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÂàá„ÇäÊõø„Åà', mastered: false },
                { key: 'Win + Ctrl + F4', desc: 'ÁèæÂú®„ÅÆ„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„ÇíÈñâ„Åò„Çã', mastered: false },
              ]
            }
          ]
        },
        'excel.exe': {
          displayName: 'Excel',
          color: '#107c41',
          groups: [
            {
              category: 'ÁßªÂãï„ÉªÈÅ∏Êäû',
              items: [
                { key: 'Ctrl + Arrow', desc: '„Éá„Éº„Çø„ÅÆÁ´Ø„Åæ„Åß„Ç∏„É£„É≥„Éó', mastered: true },
                { key: 'Ctrl + Shift + Arrow', desc: '„Éá„Éº„Çø„ÅÆÁ´Ø„Åæ„ÅßÈÅ∏Êäû', mastered: false },
                { key: 'Ctrl + PgUp/Dn', desc: '„Ç∑„Éº„ÉàÂàá„ÇäÊõø„Åà', mastered: false },
                { key: 'Ctrl + Home', desc: 'A1„Çª„É´„Å´Êàª„Çã', mastered: true },
                { key: 'Alt + PgUp/Dn', desc: '1ÁîªÈù¢ÂàÜ Â∑¶Âè≥„Çπ„ÇØ„É≠„Éº„É´', mastered: false },
              ]
            },
            {
              category: 'Á∑®ÈõÜ„ÉªÂÖ•Âäõ',
              items: [
                { key: 'F2', desc: '„Çª„É´Á∑®ÈõÜ„É¢„Éº„Éâ', mastered: true },
                { key: 'Alt + Enter', desc: '„Çª„É´ÂÜÖÊîπË°å', mastered: false },
                { key: 'Ctrl + D', desc: '‰∏ä„ÅÆ„Çª„É´„Çí„Ç≥„Éî„Éº (‰∏ãÊñπÂêë)', mastered: false },
                { key: 'Ctrl + R', desc: 'Â∑¶„ÅÆ„Çª„É´„Çí„Ç≥„Éî„Éº (Âè≥ÊñπÂêë)', mastered: false },
                { key: 'Alt + E + S', desc: 'ÂΩ¢Âºè„ÇíÈÅ∏Êäû„Åó„Å¶Ë≤º„Çä‰ªò„Åë', mastered: false },
                { key: 'Ctrl + -', desc: 'Ë°å/Âàó„ÅÆÂâäÈô§', mastered: false },
                { key: 'Ctrl + Shift + +', desc: 'Ë°å/Âàó„ÅÆÊåøÂÖ•', mastered: false },
              ]
            },
            {
              category: 'Êõ∏Âºè„Éª„Éá„Éº„Çø',
              items: [
                { key: 'Ctrl + 1', desc: '„Çª„É´„ÅÆÊõ∏ÂºèË®≠ÂÆö', mastered: true },
                { key: 'Ctrl + Shift + 1', desc: 'Ê°ÅÂå∫Âàá„Çä„Çπ„Çø„Ç§„É´', mastered: false },
                { key: 'Ctrl + Shift + 4', desc: 'ÈÄöË≤®„Çπ„Çø„Ç§„É´', mastered: false },
                { key: 'Ctrl + Shift + L', desc: '„Éï„Ç£„É´„Çø„Éº ON/OFF', mastered: false },
                { key: 'Alt + Shift + ‚Üí', desc: '„Ç∞„É´„Éº„ÉóÂåñ', mastered: false },
                { key: 'Alt + =', desc: '„Ç™„Éº„ÉàSUM', mastered: false },
                { key: 'Ctrl + T', desc: '„ÉÜ„Éº„Éñ„É´„Å´Â§âÊèõ', mastered: false },
              ]
            }
          ]
        },
        'winword.exe': {
          displayName: 'Word',
          color: '#2b579a',
          groups: [
            {
              category: 'ÊñáÂ≠óÊõ∏Âºè',
              items: [
                { key: 'Ctrl + B/I/U', desc: 'Â§™Â≠ó / Êñú‰Ωì / ‰∏ãÁ∑ö', mastered: true },
                { key: 'Ctrl + Shift + C', desc: 'Êõ∏Âºè„ÅÆ„Ç≥„Éî„Éº', mastered: false },
                { key: 'Ctrl + Shift + V', desc: 'Êõ∏Âºè„ÅÆË≤º„Çä‰ªò„Åë', mastered: false },
                { key: 'Ctrl + Space', desc: 'Êõ∏Âºè„ÅÆËß£Èô§', mastered: false },
                { key: 'Shift + F3', desc: 'Â§ßÊñáÂ≠ó/Â∞èÊñáÂ≠ó Â§âÊèõ', mastered: false },
                { key: 'Ctrl + [ / ]', desc: '„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Â§âÊõ¥', mastered: false },
              ]
            },
            {
              category: 'ÊÆµËêΩ„Éª„É¨„Ç§„Ç¢„Ç¶„Éà',
              items: [
                { key: 'Ctrl + E', desc: '‰∏≠Â§ÆÊèÉ„Åà', mastered: true },
                { key: 'Ctrl + J', desc: '‰∏°Á´ØÊèÉ„Åà', mastered: false },
                { key: 'Ctrl + L / R', desc: 'Â∑¶ÊèÉ„Åà / Âè≥ÊèÉ„Åà', mastered: false },
                { key: 'Ctrl + 1 / 2', desc: 'Ë°åÈñì 1ÂÄç / 2ÂÄç', mastered: false },
                { key: 'Ctrl + M', desc: '„Ç§„É≥„Éá„É≥„ÉàËøΩÂä†', mastered: false },
              ]
            },
            {
              category: 'ÊåøÂÖ•„ÉªÁ∑®ÈõÜ',
              items: [
                { key: 'Ctrl + Enter', desc: 'Êîπ„Éö„Éº„Ç∏', mastered: true },
                { key: 'Shift + Enter', desc: 'ÊÆµËêΩÂÜÖÊîπË°å', mastered: false },
                { key: 'Ctrl + Alt + 1', desc: 'Ë¶ãÂá∫„Åó1 „Çπ„Çø„Ç§„É´', mastered: false },
                { key: 'Ctrl + Alt + 2', desc: 'Ë¶ãÂá∫„Åó2 „Çπ„Çø„Ç§„É´', mastered: false },
                { key: 'Alt + Shift + D', desc: '‰ªäÊó•„ÅÆÊó•‰ªòÊåøÂÖ•', mastered: false },
              ]
            }
          ]
        },
        'powerpnt.exe': {
          displayName: 'PowerPoint',
          color: '#c43e1c',
          groups: [
            {
              category: '„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº',
              items: [
                { key: 'F5', desc: 'ÊúÄÂàù„Åã„ÇâÂÜçÁîü', mastered: true },
                { key: 'Shift + F5', desc: 'ÁèæÂú®„ÅÆ„Çπ„É©„Ç§„Éâ„Åã„ÇâÂÜçÁîü', mastered: true },
                { key: 'B / .', desc: 'ÁîªÈù¢„ÇíÈªí„Å´„Åô„Çã (Black)', mastered: false },
                { key: 'W / ,', desc: 'ÁîªÈù¢„ÇíÁôΩ„Å´„Åô„Çã (White)', mastered: false },
                { key: 'Ctrl + P', desc: '„Éö„É≥„ÉÑ„Éº„É´', mastered: false },
              ]
            },
            {
              category: 'Á∑®ÈõÜ„ÉªÂõ≥ÂΩ¢',
              items: [
                { key: 'Ctrl + M', desc: 'Êñ∞„Åó„ÅÑ„Çπ„É©„Ç§„Éâ', mastered: true },
                { key: 'Ctrl + D', desc: 'Ë§áË£Ω (Âõ≥ÂΩ¢/„Çπ„É©„Ç§„Éâ)', mastered: false },
                { key: 'Ctrl + G', desc: '„Ç∞„É´„Éº„ÉóÂåñ', mastered: false },
                { key: 'Ctrl + Shift + G', desc: '„Ç∞„É´„Éº„ÉóËß£Èô§', mastered: false },
                { key: 'Ctrl + Shift + C', desc: 'Âõ≥ÂΩ¢„ÅÆÊõ∏Âºè„Ç≥„Éî„Éº', mastered: false },
                { key: 'Ctrl + Shift + Drag', desc: 'Ê∞¥Âπ≥/ÂûÇÁõ¥„Å´„Ç≥„Éî„Éº', mastered: false },
              ]
            }
          ]
        },
        'chrome.exe': {
          displayName: 'Chrome',
          color: '#ea4335',
          groups: [
            {
              category: '„Çø„ÉñÊìç‰Ωú',
              items: [
                { key: 'Ctrl + T', desc: 'Êñ∞„Åó„ÅÑ„Çø„Éñ', mastered: true },
                { key: 'Ctrl + Shift + T', desc: 'Èñâ„Åò„Åü„Çø„Éñ„ÇíÂæ©ÂÖÉ (Á•û)', mastered: true },
                { key: 'Ctrl + W', desc: 'ÁèæÂú®„ÅÆ„Çø„Éñ„ÇíÈñâ„Åò„Çã', mastered: true },
                { key: 'Ctrl + Tab', desc: 'Ê¨°„ÅÆ„Çø„Éñ„Å∏', mastered: false },
                { key: 'Ctrl + Shift + Tab', desc: 'Ââç„ÅÆ„Çø„Éñ„Å∏', mastered: false },
              ]
            },
            {
              category: '„Éñ„É©„Ç¶„Ç∏„É≥„Ç∞',
              items: [
                { key: 'Alt + ‚Üê / ‚Üí', desc: 'Êàª„Çã / ÈÄ≤„ÇÄ', mastered: true },
                { key: 'Ctrl + L', desc: '„Ç¢„Éâ„É¨„Çπ„Éê„Éº„ÇíÈÅ∏Êäû', mastered: true },
                { key: 'Ctrl + F', desc: '„Éö„Éº„Ç∏ÂÜÖÊ§úÁ¥¢', mastered: true },
                { key: 'Ctrl + R', desc: 'Êõ¥Êñ∞ („É™„É≠„Éº„Éâ)', mastered: true },
                { key: 'Ctrl + Shift + R', desc: '„Çπ„Éº„Éë„Éº„É™„É≠„Éº„Éâ', mastered: false },
                { key: 'Ctrl + Shift + N', desc: '„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà„É¢„Éº„Éâ', mastered: false },
              ]
            }
          ]
        }
      };

      const [shortcutsData, setShortcutsData] = useState(() => {
        try {
          const saved = localStorage.getItem('hud_shortcuts_v3');
          return saved ? JSON.parse(saved) : initialData;
        } catch(e) { return initialData; }
      });

      useEffect(() => {
        localStorage.setItem('hud_shortcuts_v3', JSON.stringify(shortcutsData));
      }, [shortcutsData]);

      const [noteMode, setNoteMode] = useState('memo');
      const [noteContent, setNoteContent] = useState('');
      const [todoList, setTodoList] = useState([]);
      const [todoInput, setTodoInput] = useState('');

      useEffect(() => {
        const noteKey = `hud_note_${activeApp}`;
        const savedNote = localStorage.getItem(noteKey) || '';
        setNoteContent(savedNote);

        const todoKey = `hud_todo_${activeApp}`;
        const savedTodo = localStorage.getItem(todoKey);
        setTodoList(savedTodo ? JSON.parse(savedTodo) : []);

        setAnimProgress(0);
        requestRef.current = requestAnimationFrame(animate);

        setSearchQuery('');
      }, [activeApp]);

      const handleNoteChange = (e) => {
        const val = e.target.value;
        setNoteContent(val);
        localStorage.setItem(`hud_note_${activeApp}`, val);
      };

      const saveTodos = (newList) => {
        setTodoList(newList);
        localStorage.setItem(`hud_todo_${activeApp}`, JSON.stringify(newList));
      };

      const addTodo = (e) => {
        e.preventDefault();
        if (!todoInput.trim()) return;
        const newTodo = { id: Date.now(), text: todoInput, done: false };
        saveTodos([...todoList, newTodo]);
        setTodoInput('');
      };

      const toggleTodo = (id) => {
        const newList = todoList.map(t => t.id === id ? { ...t, done: !t.done } : t);
        saveTodos(newList);
      };

      const deleteTodo = (id) => {
        if (focusedTaskId === id) {
          setFocusedTaskId(null);
          setIsTimerRunning(false);
        }
        const newList = todoList.filter(t => t.id !== id);
        saveTodos(newList);
      };

      const [timerMode, setTimerMode] = useState('focus');
      const [timeLeft, setTimeLeft] = useState(25 * 60);
      const [isTimerRunning, setIsTimerRunning] = useState(false);
      const [focusedTaskId, setFocusedTaskId] = useState(null);

      useEffect(() => {
        let interval = null;
        if (isTimerRunning && timeLeft > 0) {
          interval = setInterval(() => {
            setTimeLeft(t => t - 1);
          }, 1000);
        } else if (timeLeft === 0) {
          setIsTimerRunning(false);
        }
        return () => clearInterval(interval);
      }, [isTimerRunning, timeLeft]);

      const toggleTimer = () => setIsTimerRunning(!isTimerRunning);

      const resetTimer = () => {
        setIsTimerRunning(false);
        setTimeLeft(timerMode === 'focus' ? 25 * 60 : 5 * 60);
        setFocusedTaskId(null);
      };

      const switchTimerMode = (mode) => {
        setTimerMode(mode);
        setIsTimerRunning(false);
        setTimeLeft(mode === 'focus' ? 25 * 60 : 5 * 60);
      };

      const startFocusOnTask = (task) => {
        if (focusedTaskId === task.id && isTimerRunning) {
          setIsTimerRunning(false);
        } else {
          setFocusedTaskId(task.id);
          setTimerMode('focus');
          setTimeLeft(25 * 60);
          setIsTimerRunning(true);
        }
      };

      const formatTimer = (seconds) => {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      };

      const focusedTaskText = useMemo(() => {
        if (!focusedTaskId) return "No Focus Task";
        const task = todoList.find(t => t.id === focusedTaskId);
        return task ? task.text : "Task Completed";
      }, [focusedTaskId, todoList]);

      const animate = (timestamp) => {
        const duration = 400;
        if (!requestRef.current.startTimestamp) requestRef.current.startTimestamp = timestamp;
        const progress = Math.min((timestamp - requestRef.current.startTimestamp) / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 4);
        setAnimProgress(ease);
        if (progress < 1) requestRef.current = requestAnimationFrame(animate);
      };

      useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const container = containerRef.current;

        const dpr = window.devicePixelRatio || 1;
        const width = container.clientWidth;
        const height = container.clientHeight;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        ctx.scale(dpr, dpr);

        const appData = shortcutsData[activeApp] || shortcutsData['desktop'];
        const config = {
          padding: 24,
          fontBase: '"Meiryo UI", "Yu Gothic UI", "Segoe UI", sans-serif',
          fontMono: '"Consolas", "Monaco", monospace',
          bgColor: 'rgba(15, 23, 42, 0.95)',
          textColor: '#e2e8f0',
          keyBgColor: 'rgba(255, 255, 255, 0.9)',
          keyTextColor: appData.color,
          accentColor: appData.color
        };

        ctx.clearRect(0, 0, width, height);

        const drawRoundedRect = (x, y, w, h, r) => {
          ctx.beginPath();
          ctx.moveTo(x + r, y);
          ctx.lineTo(x + w - r, y);
          ctx.quadraticCurveTo(x + w, y, x + w, y + r);
          ctx.lineTo(x + w, y + h - r);
          ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
          ctx.lineTo(x + r, y + h);
          ctx.quadraticCurveTo(x, y + h, x, y + h - r);
          ctx.lineTo(x, y + r);
          ctx.quadraticCurveTo(x, y, x + r, y);
          ctx.closePath();
        };

        ctx.save();
        const slideOffset = 20 * (1 - animProgress);
        ctx.globalAlpha = animProgress;
        ctx.translate(0, slideOffset);

        ctx.fillStyle = config.bgColor;
        drawRoundedRect(0, 0, width, height, 12);
        ctx.fill();

        ctx.strokeStyle = config.accentColor;
        ctx.lineWidth = 2;
        ctx.shadowColor = config.accentColor;
        ctx.shadowBlur = 10;
        drawRoundedRect(0, 0, width, height, 12);
        ctx.stroke();

        ctx.clip();
        ctx.shadowBlur = 0;

        ctx.save();
        ctx.translate(0, -scrollOffset);

        let currentY = config.padding + 80;

        if (appData.groups) {
          appData.groups.forEach(group => {
            const visibleItems = group.items.filter(item => {
              if (showUnmasteredOnly && item.mastered) return false;
              if (searchQuery) {
                const q = searchQuery.toLowerCase();
                return item.key.toLowerCase().includes(q) || item.desc.toLowerCase().includes(q);
              }
              return true;
            });

            if (visibleItems.length === 0) return;

            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = `bold 12px ${config.fontBase}`;
            ctx.fillText(group.category, config.padding + 10, currentY);
            currentY += 24;

            visibleItems.forEach(item => {
              ctx.font = `bold 13px ${config.fontMono}`;
              const keyText = item.key;
              const keyWidth = ctx.measureText(keyText).width;

              ctx.fillStyle = config.keyBgColor;
              ctx.shadowColor = 'rgba(0,0,0,0.3)';
              ctx.shadowBlur = 3;
              ctx.shadowOffsetY = 1;

              const keyRectW = keyWidth + 14;
              ctx.fillRect(config.padding + 10, currentY - 16, keyRectW, 22);

              ctx.shadowColor = 'transparent';
              ctx.shadowBlur = 0;
              ctx.shadowOffsetY = 0;

              ctx.fillStyle = config.keyTextColor;
              ctx.fillText(keyText, config.padding + 17, currentY);

              const minDescX = 170;
              const descX = Math.max(config.padding + minDescX, config.padding + 10 + keyWidth + 30);

              ctx.font = `13px ${config.fontBase}`;
              ctx.fillStyle = config.textColor;
              ctx.fillText(item.desc, descX, currentY);

              if (item.mastered) {
                 ctx.fillStyle = '#4ade80';
                 ctx.font = `12px ${config.fontBase}`;
                 ctx.fillText('‚úì', width - config.padding - 20, currentY);
              }

              currentY += 28;
            });

            currentY += 16;
          });

          if (currentY === config.padding + 80) {
            ctx.fillStyle = 'rgba(255,255,255,0.4)';
            ctx.font = `14px ${config.fontBase}`;
            ctx.fillText("Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„Çã„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì", config.padding + 10, currentY + 30);
          }
        }

        ctx.restore();

        ctx.fillStyle = config.bgColor;
        ctx.fillRect(2, 2, width - 4, 85);

        ctx.beginPath();
        ctx.arc(config.padding + 20, config.padding + 20, 15, 0, Math.PI * 2);
        ctx.fillStyle = config.accentColor;
        ctx.fill();

        ctx.fillStyle = '#ffffff';
        ctx.font = `bold 24px ${config.fontBase}`;
        ctx.fillText(appData.displayName.toUpperCase(), config.padding + 45, config.padding + 28);

        if (searchQuery) {
            ctx.fillStyle = config.accentColor;
            ctx.font = `bold 12px ${config.fontBase}`;
            ctx.fillText(`FILTER: "${searchQuery}"`, width - config.padding - 100, config.padding + 28);
        }

        ctx.beginPath();
        ctx.moveTo(config.padding, config.padding + 85);
        ctx.lineTo(width - config.padding, config.padding + 85);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.lineWidth = 1;
        ctx.stroke();

        ctx.restore();

      }, [activeApp, shortcutsData, animProgress, scrollOffset, searchQuery, showUnmasteredOnly]);

      const exportData = () => {
        const data = {};
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('hud_')) {
                data[key] = localStorage.getItem(key);
            }
        });
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `shortcut_hud_backup_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const importData = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const json = JSON.parse(event.target.result);
                    Object.keys(json).forEach(key => {
                       if (key.startsWith('hud_')) {
                           localStorage.setItem(key, json[key]);
                       }
                    });
                    alert('„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ');
                    window.location.reload();
                } catch(err) {
                    alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };
            reader.readAsText(file);
        };
        input.click();
      };

      const handleEditClick = () => {
        const data = JSON.parse(JSON.stringify(shortcutsData[activeApp] || shortcutsData['desktop']));
        setEditingData(data);
        setIsEditing(true);
      };

      const handleSave = () => {
        setShortcutsData(prev => ({ ...prev, [activeApp]: editingData }));
        setIsEditing(false);
        setAnimProgress(0);
        requestRef.current.startTimestamp = null;
        requestRef.current = requestAnimationFrame(animate);
      };

      const updateItem = (gIndex, iIndex, field, val) => {
        const newData = { ...editingData }; newData.groups[gIndex].items[iIndex][field] = val; setEditingData(newData);
      };

      const toggleItemMastery = (gIndex, iIndex) => {
        const newData = { ...editingData };
        const current = newData.groups[gIndex].items[iIndex].mastered;
        newData.groups[gIndex].items[iIndex].mastered = !current;
        setEditingData(newData);
      };

      const updateGroupName = (gIndex, val) => {
        const newData = { ...editingData }; newData.groups[gIndex].category = val; setEditingData(newData);
      };

      const deleteItem = (gIndex, iIndex) => {
        const newData = { ...editingData }; newData.groups[gIndex].items.splice(iIndex, 1); setEditingData(newData);
      };

      const addItem = (gIndex) => {
        const newData = { ...editingData }; newData.groups[gIndex].items.push({ key: '„Ç≠„Éº', desc: 'Ë™¨Êòé', mastered: false }); setEditingData(newData);
      };

      const addGroup = () => {
        const newData = { ...editingData }; if(!newData.groups) newData.groups=[]; newData.groups.push({category:'Êñ∞Ë¶è„Ç´„ÉÜ„Ç¥„É™', items:[]}); setEditingData(newData);
      };

      const deleteGroup = (gIndex) => {
        if(!window.confirm('„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return; const newData = { ...editingData }; newData.groups.splice(gIndex, 1); setEditingData(newData);
      };

      return (
        <div className="flex flex-col h-screen bg-slate-950 text-white font-sans overflow-hidden">

          <div className="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-20 shadow-xl shrink-0">
            <div className="flex items-center space-x-4 w-full overflow-x-auto no-scrollbar">
              <div className="flex items-center text-slate-400 shrink-0 border-r border-slate-700 pr-4 mr-2">
                <Icons.Monitor />
                <span className="text-sm font-bold tracking-widest hidden md:inline ml-2">HUD v3.0</span>
              </div>

              <div className="flex space-x-1">
                {Object.keys(shortcutsData).map((exeName) => {
                  const app = shortcutsData[exeName];
                  const isActive = activeApp === exeName;
                  return (
                    <button
                      key={exeName}
                      onClick={() => setActiveApp(exeName)}
                      style={{
                        borderColor: isActive ? app.color : 'transparent',
                        backgroundColor: isActive ? `${app.color}20` : 'transparent',
                        color: isActive ? app.color : '#64748b'
                      }}
                      className={`
                        px-3 py-1.5 rounded-lg text-xs font-bold transition-all duration-200 whitespace-nowrap border
                        hover:bg-slate-800 flex items-center
                        ${isActive ? 'shadow-[0_0_10px_rgba(0,0,0,0.3)]' : ''}
                      `}
                    >
                      <span className="w-2 h-2 rounded-full mr-2" style={{ backgroundColor: app.color }}></span>
                      {app.displayName}
                    </button>
                  );
                })}
              </div>
            </div>

            <div className="flex items-center space-x-2 ml-4 shrink-0">
               <button
                onClick={() => setIsSettingsOpen(true)}
                className="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors"
                title="Ë®≠ÂÆö„Éª„Éá„Éº„ÇøÁÆ°ÁêÜ"
               >
                 <Icons.Settings />
               </button>
               <button
                onClick={handleEditClick}
                className="flex items-center px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 border border-blue-500/50 rounded text-xs font-bold transition-all"
               >
                <Icons.Edit className="w-4 h-4 mr-2" />
                „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÁ∑®ÈõÜ
               </button>
            </div>
          </div>

          <div className="flex-1 relative bg-[url('https://images.unsplash.com/photo-1519608487953-e999c86e7455?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center">
            <div className="absolute inset-0 bg-slate-950/80 backdrop-blur-sm"></div>

            <div className="relative z-10 w-full h-full flex p-6 gap-6">

              <div className="w-72 flex flex-col gap-4 animate-in slide-in-from-left duration-500">

                <div className="bg-slate-900/90 backdrop-blur border border-slate-700 rounded-xl p-5 shadow-lg shrink-0">
                  <div className="flex items-center text-slate-400 mb-2">
                    <Icons.Clock className="w-4 h-4 mr-2" />
                    <span className="text-xs font-bold tracking-wider">ÁèæÂú®ÊôÇÂàª</span>
                  </div>
                  <div className="text-4xl font-mono text-white font-bold tracking-tight tabular-nums">
                    {time.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                  </div>
                  <div className="text-slate-400 text-sm mt-1">
                    {time.toLocaleDateString('ja-JP', { weekday: 'long', month: 'long', day: 'numeric' })}
                  </div>
                </div>

                <div className="flex-1 bg-slate-900/90 backdrop-blur border border-slate-700 rounded-xl shadow-lg flex flex-col overflow-hidden relative">
                  <div
                    className="absolute top-0 right-0 px-3 py-1 rounded-bl-lg text-[10px] font-bold text-white z-10 shadow-sm"
                    style={{ backgroundColor: shortcutsData[activeApp]?.color || '#64748b' }}
                  >
                    {shortcutsData[activeApp]?.displayName} Mode
                  </div>

                  <div className="flex border-b border-slate-700 pt-2">
                    <button
                      onClick={() => setNoteMode('memo')}
                      className={`flex-1 py-3 text-xs font-bold flex items-center justify-center transition-colors ${noteMode === 'memo' ? 'text-blue-400 border-b-2 border-blue-400 bg-slate-800/50' : 'text-slate-500 hover:text-slate-300'}`}
                    >
                      <Icons.FileText className="w-3 h-3 mr-2" /> „É°„É¢Â∏≥
                    </button>
                    <button
                      onClick={() => setNoteMode('todo')}
                      className={`flex-1 py-3 text-xs font-bold flex items-center justify-center transition-colors ${noteMode === 'todo' ? 'text-green-400 border-b-2 border-green-400 bg-slate-800/50' : 'text-slate-500 hover:text-slate-300'}`}
                    >
                      <Icons.CheckSquare className="w-3 h-3 mr-2" /> ToDo
                    </button>
                  </div>
                  <div className="flex-1 relative overflow-hidden bg-slate-950/30">
                    {noteMode === 'memo' ? (
                      <textarea
                        value={noteContent}
                        onChange={handleNoteChange}
                        placeholder={`${shortcutsData[activeApp]?.displayName} „Å´Èñ¢„Åô„Çã„É°„É¢...`}
                        className="w-full h-full bg-transparent text-slate-300 p-4 focus:outline-none resize-none text-sm leading-relaxed custom-scrollbar font-sans placeholder-slate-600"
                        spellCheck="false"
                      />
                    ) : (
                      <div className="flex flex-col h-full">
                        <div className="flex-1 overflow-y-auto p-2 custom-scrollbar space-y-1">
                          {todoList.length === 0 && <div className="text-center text-slate-600 text-xs mt-10">„Çø„Çπ„ÇØ„Å™„Åó</div>}
                          {todoList.map(todo => (
                            <div key={todo.id} className={`flex items-center group p-2 rounded hover:bg-slate-800/50 transition-colors ${todo.done ? 'opacity-50' : ''}`}>
                              <button onClick={() => toggleTodo(todo.id)} className={`w-4 h-4 rounded border mr-2 flex shrink-0 items-center justify-center transition-colors ${todo.done ? 'bg-green-500 border-green-500' : 'border-slate-500 hover:border-green-400'}`}>
                                {todo.done && <span className="text-white text-xs">‚úì</span>}
                              </button>

                              <span className={`flex-1 text-sm truncate mr-2 ${todo.done ? 'line-through text-slate-500' : 'text-slate-200'}`}>{todo.text}</span>

                              {!todo.done && (
                                 <button
                                    onClick={() => startFocusOnTask(todo)}
                                    title="„Åì„ÅÆ„Çø„Çπ„ÇØ„Å´ÈõÜ‰∏≠„Åô„Çã"
                                    className={`p-1 rounded-full ${focusedTaskId === todo.id && isTimerRunning ? 'text-yellow-400 bg-yellow-400/10' : 'text-slate-600 hover:text-yellow-400 opacity-0 group-hover:opacity-100'} transition-all`}
                                 >
                                   {focusedTaskId === todo.id && isTimerRunning ? <Icons.Pause className="w-3 h-3"/> : <Icons.Play className="w-3 h-3"/>}
                                 </button>
                              )}

                              <button onClick={() => deleteTodo(todo.id)} className="opacity-0 group-hover:opacity-100 text-slate-600 hover:text-red-400 p-1 transition-opacity ml-1">
                                <Icons.Trash2 className="w-3 h-3" />
                              </button>
                            </div>
                          ))}
                        </div>
                        <form onSubmit={addTodo} className="p-3 border-t border-slate-700 bg-slate-800/50 flex">
                          <input value={todoInput} onChange={(e) => setTodoInput(e.target.value)} placeholder="„Çø„Çπ„ÇØËøΩÂä†..." className="flex-1 bg-slate-900 text-slate-200 text-xs px-3 py-2 rounded-l border border-slate-700 focus:border-green-500 focus:outline-none" />
                          <button type="submit" className="bg-green-600 hover:bg-green-500 text-white px-3 py-2 rounded-r text-xs font-bold transition-colors">
                            <Icons.Plus className="w-3 h-3" />
                          </button>
                        </form>
                      </div>
                    )}
                  </div>
                </div>

              </div>

              <div className="flex-1 flex flex-col gap-4 animate-in slide-in-from-bottom duration-500 delay-100">

                <div className="bg-slate-900/90 backdrop-blur border border-slate-700 rounded-xl p-5 shadow-lg flex flex-col items-center justify-center relative overflow-hidden group">
                  <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-50"></div>

                  <div className="flex items-center space-x-4 mb-2 z-10">
                    <button onClick={() => switchTimerMode('focus')} className={`px-3 py-1 rounded-full text-xs font-bold transition-colors ${timerMode === 'focus' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-500'}`}>ÈõÜ‰∏≠ (25min)</button>
                    <button onClick={() => switchTimerMode('break')} className={`px-3 py-1 rounded-full text-xs font-bold transition-colors ${timerMode === 'break' ? 'bg-green-600 text-white' : 'bg-slate-800 text-slate-500'}`}>‰ºëÊÜ© (5min)</button>
                  </div>

                  <div className="text-6xl font-mono font-bold text-white tracking-tighter mb-2 z-10 tabular-nums">
                    {formatTimer(timeLeft)}
                  </div>

                  <div className="h-6 mb-4 z-10">
                     {focusedTaskId && (
                        <div className="flex items-center text-xs text-yellow-400 bg-yellow-400/10 px-3 py-1 rounded-full border border-yellow-400/20 animate-pulse">
                            <span className="mr-2">üéØ</span>
                            <span className="max-w-[150px] truncate">Focusing: {focusedTaskText}</span>
                        </div>
                     )}
                  </div>

                  <div className="flex items-center space-x-4 z-10">
                    <button onClick={toggleTimer} className={`w-12 h-12 rounded-full flex items-center justify-center transition-all ${isTimerRunning ? 'bg-yellow-500 hover:bg-yellow-400 scale-105' : 'bg-blue-600 hover:bg-blue-500'} text-white shadow-lg`}>
                      {isTimerRunning ? <Icons.Pause /> : <Icons.Play />}
                    </button>
                    <button onClick={resetTimer} className="w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-slate-300 transition-colors">
                      <Icons.RotateCcw />
                    </button>
                  </div>

                  <div className={`absolute -bottom-10 -right-10 w-40 h-40 rounded-full blur-3xl pointer-events-none transition-colors duration-1000 ${isTimerRunning ? 'bg-yellow-500/10' : 'bg-blue-500/10'}`}></div>
                </div>

                <div className="flex-1 bg-slate-900/90 backdrop-blur border border-slate-700 rounded-xl p-5 shadow-lg flex flex-col relative overflow-hidden">
                   <div className="flex items-center text-slate-400 mb-4 z-10">
                    <Icons.Calendar className="w-4 h-4 mr-2" />
                    <span className="text-xs font-bold tracking-wider">CALENDAR</span>
                  </div>

                  <div className="grid grid-cols-7 gap-1 text-center text-xs font-bold text-slate-500 mb-2 z-10">
                    <div>Êó•</div><div>Êúà</div><div>ÁÅ´</div><div>Ê∞¥</div><div>Êú®</div><div>Èáë</div><div>Âúü</div>
                  </div>
                  <div className="grid grid-cols-7 gap-1 text-center text-sm z-10">
                    {getCalendarDays().map((d, i) => (
                      <div key={i} className={`p-1.5 rounded-md ${!d ? '' : d === currentDay ? 'bg-blue-600 text-white font-bold shadow' : 'text-slate-300 hover:bg-slate-800'}`}>
                        {d}
                      </div>
                    ))}
                  </div>
                </div>

              </div>

              <div className="w-[450px] flex flex-col h-full bg-slate-900/90 backdrop-blur border border-slate-700 rounded-xl shadow-lg relative overflow-hidden transition-all">

                <div className="h-14 border-b border-slate-700 flex items-center justify-between px-4 bg-slate-900 z-20">
                   <div className="relative flex-1 mr-4">
                      <Icons.Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-500" />
                      <input
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„ÇíÊ§úÁ¥¢..."
                        className="w-full bg-slate-800 text-slate-200 text-xs pl-9 pr-3 py-2 rounded-lg border border-slate-700 focus:border-blue-500 focus:outline-none"
                      />
                   </div>
                   <button
                     onClick={() => setShowUnmasteredOnly(!showUnmasteredOnly)}
                     className={`p-2 rounded-lg text-xs font-bold flex items-center transition-all ${showUnmasteredOnly ? 'bg-green-600/20 text-green-400 border border-green-500/50' : 'text-slate-500 hover:bg-slate-800'}`}
                     title={showUnmasteredOnly ? "Êú™ÁøíÂæó„ÅÆ„ÅøË°®Á§∫‰∏≠" : "„Åô„Åπ„Å¶Ë°®Á§∫‰∏≠"}
                   >
                     <Icons.CheckCircle className={showUnmasteredOnly ? "w-4 h-4 fill-current" : "w-4 h-4"} />
                   </button>
                </div>

                <div
                    ref={containerRef}
                    onWheel={(e) => setScrollOffset(prev => Math.max(0, prev + e.deltaY))}
                    className="flex-1 relative cursor-ns-resize"
                >
                    <canvas ref={canvasRef} className="w-full h-full block" />
                </div>

              </div>

            </div>

            {isSettingsOpen && (
               <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/80 p-4 backdrop-blur-md">
                 <div className="bg-slate-900 w-full max-w-md p-6 rounded-xl shadow-2xl border border-slate-700 animate-in zoom-in-95 duration-200">
                   <div className="flex justify-between items-center mb-6">
                     <h3 className="text-lg font-bold text-white flex items-center">
                       <Icons.Settings className="w-5 h-5 mr-2" /> „Éá„Éº„ÇøÁÆ°ÁêÜ
                     </h3>
                     <button onClick={() => setIsSettingsOpen(false)}>
                       <Icons.X className="w-5 h-5 text-slate-400 hover:text-white" />
                     </button>
                   </div>
                   <div className="space-y-4">
                     <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-700">
                        <p className="text-xs text-slate-400 mb-3">„Åô„Åπ„Å¶„ÅÆ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„ÄÅ„É°„É¢„ÄÅToDo„Éá„Éº„Çø„ÇíJSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ</p>
                        <button onClick={exportData} className="w-full flex items-center justify-center py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-bold transition-colors">
                          <Icons.Download className="w-4 h-4 mr-2" /> „Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                        </button>
                     </div>
                     <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-700">
                        <p className="text-xs text-slate-400 mb-3">‰øùÂ≠ò„Åó„ÅüJSON„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Çì„Åß„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÄÇ</p>
                        <button onClick={importData} className="w-full flex items-center justify-center py-2 bg-slate-700 hover:bg-slate-600 text-white rounded text-sm font-bold transition-colors">
                          <Icons.Upload className="w-4 h-4 mr-2" /> „Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà
                        </button>
                     </div>
                   </div>
                 </div>
               </div>
            )}

            {isEditing && editingData && (
              <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/80 p-4 backdrop-blur-md">
                <div className="bg-slate-900 w-full max-w-4xl h-[85vh] rounded-xl shadow-2xl border border-slate-700 flex flex-col animate-in zoom-in-95 duration-200">
                  <div className="p-4 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center rounded-t-xl">
                    <h3 className="text-lg font-bold text-white flex items-center">
                      <Icons.Keyboard className="w-5 h-5 mr-2 text-blue-400" />
                      Á∑®ÈõÜ‰∏≠„ÅÆ„Ç¢„Éó„É™: <span className="text-blue-400 ml-1">{editingData.displayName}</span>
                    </h3>
                    <button onClick={() => setIsEditing(false)}>
                      <Icons.X className="w-5 h-5 text-slate-400 hover:text-white" />
                    </button>
                  </div>
                  <div className="flex-1 overflow-y-auto p-6 space-y-6 bg-slate-900 custom-scrollbar">
                    {editingData.groups.map((group, gIndex) => (
                      <div key={gIndex} className="bg-slate-800/40 rounded-lg border border-slate-700/50 p-4">
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center flex-1 mr-4">
                            <span className="text-xs text-slate-500 font-mono mr-2">„Ç´„ÉÜ„Ç¥„É™</span>
                            <input value={group.category} onChange={(e) => updateGroupName(gIndex, e.target.value)} className="bg-transparent text-blue-300 font-bold border-b border-slate-600 focus:border-blue-400 focus:outline-none w-full py-1" />
                          </div>
                          <div className="flex space-x-1">
                            <button onClick={() => deleteGroup(gIndex)} className="p-1 text-red-500 hover:bg-red-900/20 rounded">
                              <Icons.Trash2 className="w-4 h-4"/>
                            </button>
                          </div>
                        </div>
                        <div className="space-y-2 pl-4 border-l-2 border-slate-700/50">
                          {group.items.map((item, iIndex) => (
                            <div key={iIndex} className="flex space-x-2 group items-center">
                              <input value={item.key} onChange={(e) => updateItem(gIndex, iIndex, 'key', e.target.value)} placeholder="„Ç≠„Éº" className="bg-slate-950 text-white text-xs font-mono p-2 rounded border border-slate-700 w-1/4" />
                              <input value={item.desc} onChange={(e) => updateItem(gIndex, iIndex, 'desc', e.target.value)} placeholder="Ë™¨Êòé" className="bg-slate-950 text-slate-300 text-xs p-2 rounded border border-slate-700 flex-1" />

                              <button
                                onClick={() => toggleItemMastery(gIndex, iIndex)}
                                className={`flex items-center px-2 py-1.5 rounded border text-xs font-bold transition-all ${item.mastered ? 'bg-green-600/20 border-green-500 text-green-400' : 'border-slate-600 text-slate-500 hover:border-slate-400'}`}
                                title="ÁøíÂæóÊ∏à„Åø„Å´„Åô„Çã"
                              >
                                 <Icons.CheckCircle className={item.mastered ? "w-3 h-3 mr-1 fill-current" : "w-3 h-3 mr-1"} />
                                 {item.mastered ? 'ÁøíÂæóÊ∏à' : 'Êú™ÁøíÂæó'}
                              </button>

                              <button onClick={() => deleteItem(gIndex, iIndex)} className="text-slate-600 hover:text-red-400 opacity-0 group-hover:opacity-100 p-1">
                                <Icons.X className="w-4 h-4" />
                              </button>
                            </div>
                          ))}
                          <button onClick={() => addItem(gIndex)} className="mt-1 text-xs text-blue-400 hover:text-blue-300 flex items-center">
                            <Icons.Plus className="w-3 h-3 mr-1"/> „Ç¢„Ç§„ÉÜ„É†ËøΩÂä†
                          </button>
                        </div>
                      </div>
                    ))}
                    <button onClick={addGroup} className="w-full py-2 border border-dashed border-slate-600 rounded text-slate-400 hover:text-white text-sm">Ôºã Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™„ÇíËøΩÂä†</button>
                  </div>
                  <div className="p-4 border-t border-slate-700 bg-slate-800/80 rounded-b-xl flex justify-end space-x-3">
                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-slate-300 hover:text-white text-sm">„Ç≠„É£„É≥„Çª„É´</button>
                    <button onClick={handleSave} className="flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-bold rounded shadow-lg">
                      <Icons.Save className="w-4 h-4 mr-2" />
                      ‰øùÂ≠ò„Åô„Çã
                    </button>
                  </div>
                </div>
              </div>
            )}

          </div>
        </div>
      );
    }

    ReactDOM.render(<ShortcutHUD />, document.getElementById('root'));
  </script>
</body>
</html>
